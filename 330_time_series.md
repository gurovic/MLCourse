# **Feature Engineering –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤**  

## **–í–≤–µ–¥–µ–Ω–∏–µ –≤ Feature Engineering –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤**  
–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ –≤ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ ‚Äî –∫–ª—é—á–µ–≤–æ–π —ç—Ç–∞–ø –¥–ª—è:  
- üìà **–ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è** (–ø—Ä–æ–¥–∞–∂–∏, –∫—É—Ä—Å –∞–∫—Ü–∏–π)  
- üïµÔ∏è **–î–µ—Ç–µ–∫—Ü–∏–∏ –∞–Ω–æ–º–∞–ª–∏–π** (–º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ, –ø–æ–ª–æ–º–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è)  
- üè∑Ô∏è **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏** (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ —Ä–∞–±–æ—Ç—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)  

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤:**  
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –º–µ–∂–¥—É –Ω–∞–±–ª—é–¥–µ–Ω–∏—è–º–∏ (–∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è)  
- –ù–∞–ª–∏—á–∏–µ —Ç—Ä–µ–Ω–¥–æ–≤ –∏ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏  
- –ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ –∏–∑–º–µ—Ä–µ–Ω–∏–π  

---

## **üü¢ –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å (–°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏)**  

### **1.1 –õ–∞–≥–∏ –∏ —Å–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏**  
```python
import pandas as pd

# –°–æ–∑–¥–∞–Ω–∏–µ –ª–∞–≥–æ–≤
data['lag_1'] = data['value'].shift(1)  # –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
data['lag_7'] = data['value'].shift(7)  # –Ω–µ–¥–µ–ª—é –Ω–∞–∑–∞–¥

# –°–∫–æ–ª—å–∑—è—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
window = 3
data['rolling_mean'] = data['value'].rolling(window).mean()
data['rolling_std'] = data['value'].rolling(window).std()
```

### **1.2 –†–∞–∑–Ω–æ—Å—Ç–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏**  
```python
# –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ —Ä–∞–∑–Ω–∏—Ü—ã
data['diff_1'] = data['value'].diff(1)  # —Ä–∞–∑–Ω–∏—Ü–∞ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
data['diff_7'] = data['value'].diff(7)  # —Ä–∞–∑–Ω–∏—Ü–∞ —Å —Ç–µ–º –∂–µ –¥–Ω–µ–º –Ω–µ–¥–µ–ª–∏ –Ω–∞–∑–∞–¥

# –õ–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–∏–µ –≤–æ–∑–≤—Ä–∞—Ç—ã (–¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö)
data['log_return'] = np.log(data['value'] / data['value'].shift(1))
```

### **1.3 –ü—Ä–∏–∑–Ω–∞–∫–∏ –≤—Ä–µ–º–µ–Ω–∏**  
```python
# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–∞—Ç—ã
data['hour'] = data.index.hour
data['day_of_week'] = data.index.dayofweek  # 0-–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫
data['is_weekend'] = data['day_of_week'].isin([5, 6]).astype(int)

# –ü—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏ (–ø—Ä–∏–º–µ—Ä –¥–ª—è –†–æ—Å—Å–∏–∏)
holidays = ['2024-01-01', '2024-03-08'] 
data['is_holiday'] = data.index.date.astype(str).isin(holidays).astype(int)
```

---

## **üü° –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å (–°–ª–æ–∂–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è)**  

### **2.1 –ß–∞—Å—Ç–æ—Ç–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (FFT)**  
```python
from scipy.fft import fft

def get_fft_features(series, n_components=5):
    fft_result = fft(series.values)
    magnitudes = np.abs(fft_result)[:n_components]  # –≥–ª–∞–≤–Ω—ã–µ —á–∞—Å—Ç–æ—Ç–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    return dict(zip([f'fft_{i}' for i in range(n_components)], magnitudes))

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ —Å–∫–æ–ª—å–∑—è—â–µ–º—É –æ–∫–Ω—É
data[['fft_0', 'fft_1']] = data['value'].rolling(24).apply(lambda x: pd.Series(get_fft_features(x)))
```

### **2.2 –ü—Ä–∏–∑–Ω–∞–∫–∏ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏**  
```python
from statsmodels.tsa.seasonal import seasonal_decompose

decomposition = seasonal_decompose(data['value'], period=24)  # –¥–ª—è —Å—É—Ç–æ—á–Ω–æ–π —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏
data['seasonal'] = decomposition.seasonal
data['trend'] = decomposition.trend
```

### **2.3 –≠–Ω—Ç—Ä–æ–ø–∏–π–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏**  
```python
from entropylib import sample_entropy

def calculate_entropy(series):
    return sample_entropy(series, m=2, r=0.2*np.std(series))

data['entropy_24h'] = data['value'].rolling(24).apply(calculate_entropy)
```

---

## **üî¥ –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å (–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏)**  

### **3.1 –ü—Ä–∏–∑–Ω–∞–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä–æ–≤**  
```python
from tensorflow.keras.models import Model
from tensorflow.keras.layers import Input, Dense

# –ü—Ä–æ—Å—Ç–æ–π –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä
input_layer = Input(shape=(24,))
encoder = Dense(8, activation='relu')(input_layer)
decoder = Dense(24, activation='linear')(encoder)
autoencoder = Model(input_layer, decoder)

autoencoder.compile(optimizer='adam', loss='mse')
autoencoder.fit(X_train, X_train, epochs=10)

# –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
encoder_model = Model(input_layer, encoder)
data['ae_features'] = encoder_model.predict(data['value'].rolling(24).to_numpy())
```

### **3.2 –ü—Ä–∏–∑–Ω–∞–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π (Change Point Detection)**  
```python
from ruptures import Binseg

def detect_changepoints(series):
    algo = Binseg(model="l2").fit(series.values)
    return algo.predict(pen=10)  # —Ç–æ—á–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è

data['changepoints'] = data['value'].rolling(100).apply(detect_changepoints)
```

### **3.3 –ì—Ä–∞—Ñ–æ–≤—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤**  
```python
import networkx as nx

def create_visibility_graph(series):
    G = nx.Graph()
    for i in range(len(series)):
        for j in range(i+1, len(series)):
            if all(series[k] < series[i] + (series[j]-series[i])*(k-i)/(j-i) for k in range(i+1,j)):
                G.add_edge(i,j)
    return G

data['graph_clustering'] = data['value'].rolling(10).apply(lambda x: nx.average_clustering(create_visibility_graph(x)))
```

---

## **üìå –¢—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è**  

### **üü¢ –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å**  
1. –î–ª—è —Ä—è–¥–∞ `[10, 12, 15, 13, 16]` —Å–æ–∑–¥–∞–π—Ç–µ:  
   - –õ–∞–≥ 1 –∏ –ª–∞–≥ 2  
   - –°–∫–æ–ª—å–∑—è—â–µ–µ —Å—Ä–µ–¥–Ω–µ–µ —Å –æ–∫–Ω–æ–º 2  

### **üü° –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å**  
1. –î–ª—è –Ω–∞–±–æ—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –æ–± —ç–Ω–µ—Ä–≥–æ–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–∏:  
   - –í—ã–¥–µ–ª–∏—Ç–µ —Å–µ–∑–æ–Ω–Ω—É—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É (—Å—É—Ç–æ—á–Ω—É—é –∏ –Ω–µ–¥–µ–ª—å–Ω—É—é)  
   - –†–∞—Å—Å—á–∏—Ç–∞–π—Ç–µ —ç–Ω—Ç—Ä–æ–ø–∏—é –¥–ª—è —Å–∫–æ–ª—å–∑—è—â–µ–≥–æ –æ–∫–Ω–∞ 24 —á–∞—Å–∞  

### **üî¥ –≠–∫—Å–ø–µ—Ä—Ç–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å**  
1. –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä—è–¥–∞ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä—ã—Ç—ã–π —Å–ª–æ–π –∫–∞–∫ –ø—Ä–∏–∑–Ω–∞–∫–∏  
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –¥–µ—Ç–µ–∫—Ü–∏—é —Ç–æ—á–µ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —Ä—è–¥–∞  

---

## **üí° –ó–∞–∫–ª—é—á–µ–Ω–∏–µ**  
**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã Feature Engineering –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤:**  
1. **–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É** (–Ω–µ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–π—Ç–µ –¥–∞–Ω–Ω—ã–µ!)  
2. **–ö–æ–º–±–∏–Ω–∏—Ä—É–π—Ç–µ –ø–æ–¥—Ö–æ–¥—ã** (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ + ML + –¥–æ–º–µ–Ω–Ω—ã–µ –∑–Ω–∞–Ω–∏—è)  
3. **–£—á–∏—Ç—ã–≤–∞–π—Ç–µ —á–∞—Å—Ç–æ—Ç—É –¥–∞–Ω–Ω—ã—Ö** (—Å–µ–∫—É–Ω–¥—ã/–¥–Ω–∏/–≥–æ–¥—ã —Ç—Ä–µ–±—É—é—Ç —Ä–∞–∑–Ω—ã—Ö –ø–æ–¥—Ö–æ–¥–æ–≤)  
4. **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ —É—Ç–µ—á–∫–∏** (–ø—Ä–∏–∑–Ω–∞–∫–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "–±—É–¥—É—â–µ–µ")  

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**  
- –î–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è: –ª–∞–≥–∏ + —Å–∫–æ–ª—å–∑—è—â–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ + —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç—å  
- –î–ª—è –∞–Ω–æ–º–∞–ª–∏–π: —ç–Ω—Ç—Ä–æ–ø–∏—è + —á–∞—Å—Ç–æ—Ç–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ + –∞–≤—Ç–æ—ç–Ω–∫–æ–¥–µ—Ä—ã  
- –î–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ–∫–æ–Ω + FFT + –≥—Ä–∞—Ñ–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã  

> **"–í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –¥–∞–Ω–Ω—ã–µ, –∞ —Ä–∞—Å—Å–∫–∞–∑ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –≤—ã–¥–µ–ª–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Å—é–∂–µ—Ç–Ω—ã–µ –ª–∏–Ω–∏–∏."**  

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:**  
- `tsfresh` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–∏–∑–Ω–∞–∫–æ–≤  
- `ruptures` ‚Äî –¥–µ—Ç–µ–∫—Ü–∏—è —Ç–æ—á–µ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è  
- `statsmodels` ‚Äî –∞–Ω–∞–ª–∏–∑ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–Ω–¥–æ–≤
